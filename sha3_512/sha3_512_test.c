#include <stdio.h>
#include <string.h>
#include <stdint.h>
#include "sha3_512.h"

#define SHA3_512_DIGEST_SIZE 64

/* ================= 测试向量定义 ================= */
// 测试用例1：字符串"abc"
#define TEST1_INPUT      "abc"
#define TEST1_INPUT_LEN  3
const uint8_t TEST1_EXPECTED[SHA3_512_DIGEST_SIZE] = {
    0xb7, 0x51, 0x85, 0x0b, 0x1a, 0x57, 0x16, 0x8a,
    0x56, 0x93, 0xcd, 0x92, 0x4b, 0x6b, 0x09, 0x6e,
    0x08, 0xf6, 0x21, 0x82, 0x74, 0x44, 0xf7, 0x0d,
    0x88, 0x4f, 0x5d, 0x02, 0x40, 0xd2, 0x71, 0x2e,
    0x10, 0xe1, 0x16, 0xe9, 0x19, 0x2a, 0xf3, 0xc9,
    0x1a, 0x7e, 0xc5, 0x76, 0x47, 0xe3, 0x93, 0x40,
    0x57, 0x34, 0x0b, 0x4c, 0xf4, 0x08, 0xd5, 0xa5,
    0x65, 0x92, 0xf8, 0x27, 0x4e, 0xec, 0x53, 0xf0
};

// 测试用例2：空字符串""
#define TEST2_INPUT      ""
#define TEST2_INPUT_LEN  0
const uint8_t TEST2_EXPECTED[SHA3_512_DIGEST_SIZE] = {
    0xa6, 0x9f, 0x73, 0xcc, 0xa2, 0x3a, 0x9a, 0xc5,
    0xc8, 0xb5, 0x67, 0xdc, 0x18, 0x5a, 0x75, 0x6e,
    0x97, 0xc9, 0x82, 0x16, 0x4f, 0xe2, 0x58, 0x59,
    0xe0, 0xd1, 0xdc, 0xc1, 0x47, 0x5c, 0x80, 0xa6,
    0x15, 0xb2, 0x12, 0x3a, 0xf1, 0xf5, 0xf9, 0x4c,
    0x11, 0xe3, 0xe9, 0x40, 0x2c, 0x3a, 0xc5, 0x58,
    0xf5, 0x00, 0x19, 0x9d, 0x95, 0xb6, 0xd3, 0xe3,
    0x01, 0x75, 0x85, 0x86, 0x28, 0x1d, 0xcd, 0x26
};

// 测试用例3：长字符串
#define TEST3_INPUT      "abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq"
#define TEST3_INPUT_LEN  56
const uint8_t TEST3_EXPECTED[SHA3_512_DIGEST_SIZE] = {
    0x04, 0xa3, 0x71, 0xe8, 0x4e, 0xcf, 0xb5, 0xb8,
    0xb7, 0x7c, 0xb4, 0x86, 0x10, 0xfc, 0xa8, 0x18,
    0x2d, 0xd4, 0x57, 0xce, 0x6f, 0x32, 0x6a, 0x0f,
    0xd3, 0xd7, 0xec, 0x2f, 0x1e, 0x91, 0x63, 0x6d,
    0xee, 0x69, 0x1f, 0xbe, 0x0c, 0x98, 0x53, 0x02,
    0xba, 0x1b, 0x0d, 0x8d, 0xc7, 0x8c, 0x08, 0x63,
    0x46, 0xb5, 0x33, 0xb4, 0x9c, 0x03, 0x0d, 0x99,
    0xa2, 0x7d, 0xaf, 0x11, 0x39, 0xd6, 0xe7, 0x5e
};

/* ================= 测试函数 ================= */
void test_sha3_vector(const char* name,
                     const uint8_t* input, uint32_t input_len,
                     const uint8_t* expected) {
    uint8_t digest[SHA3_512_DIGEST_SIZE];
    int passed = 1;

    printf("\n=== %s ===\n", name);

    // 执行哈希计算
    sha3_512(input, input_len, digest, SHA3_512_DIGEST_SIZE);

    // 打印输入
    printf("Input: \"");
    for (uint32_t i = 0; i < input_len; i++) printf("%c", input[i]);
    printf("\"\n");

    // 打印预期输出
    printf("Expected:   ");
    for (uint32_t i = 0; i < SHA3_512_DIGEST_SIZE; i++) printf("%02x", expected[i]);
    printf("\n");

    // 打印实际输出
    printf("Digest:     ");
    for (uint32_t i = 0; i < SHA3_512_DIGEST_SIZE; i++) printf("%02x", digest[i]);
    printf("\n");

    // 验证结果
    if (memcmp(expected, digest, SHA3_512_DIGEST_SIZE) != 0) {
        passed = 0;
        printf("--> FAIL\n");
    } else {
        printf("--> PASS\n");
    }
}

int test_sha3_512() {
    int all_passed = 1;

    // 测试用例1
    test_sha3_vector("Test 1 (\"abc\")",
                    (const uint8_t*)TEST1_INPUT, TEST1_INPUT_LEN,
                    TEST1_EXPECTED);

    // 测试用例2
    test_sha3_vector("Test 2 (empty string)",
                    (const uint8_t*)TEST2_INPUT, TEST2_INPUT_LEN,
                    TEST2_EXPECTED);

    // 测试用例3
    test_sha3_vector("Test 3 (long string)",
                    (const uint8_t*)TEST3_INPUT, TEST3_INPUT_LEN,
                    TEST3_EXPECTED);

    // 最终结果
    printf("\n=== Final Result ===\n");
    if (all_passed) {
        printf("All test vectors passed!\n");
    } else {
        printf("Some test vectors failed.\n");
    }

    return all_passed ? 0 : 1;
}